var fwLogin=angular.module("fwLogin",["facapp"]);fwLogin.controller("loginCtr",function($scope,$rootScope,$http,fwToolbar,faConfig,fwConnect){null!=localStorage.getItem("token")&&chrome.tabs.getCurrent(function(tab){chrome.tabs.update(tab.id,{url:chrome.extension.getURL("options.html")})});var login=$scope.login={};login.submitLogin=function(login_form){login_form.$valid&&(login.dis=!0,$http.post(faConfig.ajaxUrl+"index.php?r=member/login",{user_name:login.email,pwd:login.pwd}).success(function(data,status,headers,config){if(1==data.code){localStorage.setItem("token",data.access_token),localStorage.setItem("username",login.email),localStorage.setItem("urls",angular.toJson(data.web_url_arr)),localStorage.setItem("ps",data.s),localStorage.setItem("pss",data.ss),localStorage.setItem("days",data.expire_days),localStorage.setItem("version",data.version);var d=new Date;localStorage.setItem("logintime",d.getTime()),localStorage.setItem("hostname",data.host_name),localStorage.setItem("mode",1),fwToolbar.setPac(!0),chrome.tabs.getCurrent(function(tab){chrome.tabs.update(tab.id,{url:chrome.extension.getURL("options.html")})}),chrome.browserAction.setIcon({path:"images/fw.png"},function(){})}else alert(data.msg),login.dis=!1,chrome.browserAction.setIcon({path:"images/icon-never.png"},function(){})}).error(function(data,status,headers,config){login.dis=!1}))},login.toReg=function(){chrome.tabs.getCurrent(function(tab){chrome.tabs.update(tab.id,{url:chrome.extension.getURL("reg.html")})})},login.toForgot=function(){chrome.tabs.getCurrent(function(tab){chrome.tabs.update(tab.id,{url:chrome.extension.getURL("forgot.html")})})}});