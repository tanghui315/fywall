var fwapp=angular.module("fwapp",["facapp"]);fwapp.controller("bgctr",function($scope,$rootScope,fwConnect,fwToolbar){var cToken=localStorage.getItem("token");return localStorage.setItem("errUrls","[]"),chrome.tabs.onUpdated.addListener(function(tabId,changeInfo,tab){if(null==localStorage.getItem("token"))return!1;if(null!=localStorage.getItem("mode")){var mode=localStorage.getItem("mode");if(3==parseInt(mode)||2==parseInt(mode))return!1}if("complete"==changeInfo.status){var userUrls=angular.fromJson(localStorage.getItem("urls")),shortUrl=fwToolbar.getShortUrl(tab.url);1==fwToolbar.inArray(userUrls,shortUrl)&&fwToolbar.setUrlerrSpro(tabId,tab.url)}else{var shortUrl=fwToolbar.getShortUrl(tab.url),userUrls=angular.fromJson(localStorage.getItem("urls"));0==fwToolbar.inArray(userUrls,shortUrl)?chrome.browserAction.setIcon({path:"images/fw.png"},function(){}):chrome.browserAction.setIcon({path:"images/icon-auto-active.png"},function(){}),localStorage.removeItem("errUrls"+tabId),chrome.browserAction.setBadgeText({text:""})}}),chrome.tabs.onActivated.addListener(function(activeInfo){if(null==localStorage.getItem("token"))return!1;if(null!=localStorage.getItem("mode")){var mode=localStorage.getItem("mode");if(3==parseInt(mode)||2==parseInt(mode))return!1}chrome.tabs.get(activeInfo.tabId,function(stab){var shortUrl=fwToolbar.getShortUrl(stab.url),userUrls=angular.fromJson(localStorage.getItem("urls"));0==fwToolbar.inArray(userUrls,shortUrl)?(chrome.browserAction.setIcon({path:"images/fw.png"},function(){}),chrome.browserAction.setBadgeText({text:""})):(chrome.browserAction.setIcon({path:"images/icon-auto-active.png"},function(){}),fwToolbar.setUrlerrSpro(activeInfo.tabId,stab.url))})}),chrome.tabs.onRemoved.addListener(function(tabId,removeInfo){localStorage.removeItem("errUrls"+tabId)}),chrome.webRequest.onErrorOccurred.addListener(function(details){if(null==localStorage.getItem("token"))return!1;if(null!=localStorage.getItem("mode")){var mode=localStorage.getItem("mode");if(3==parseInt(mode)||2==parseInt(mode))return!1}var shortUrl=fwToolbar.getShortUrl(details.url);chrome.tabs.query({active:!0,windowId:chrome.windows.WINDOW_ID_CURRENT},function(tabs){if(details.tabId!=tabs[0].id)return!1;if(shortUrl){var tabShortUrl=fwToolbar.getShortUrl(tabs[0].url);if(tabShortUrl){var userUrls=angular.fromJson(localStorage.getItem("urls"));if(!fwToolbar.inArray(userUrls,tabShortUrl))return!1;if(tabShortUrl!=shortUrl&&!fwToolbar.inArray(userUrls,shortUrl))if(null!=localStorage.getItem("errUrls"+tabs[0].id)){var errUrlJosn=localStorage.getItem("errUrls"+tabs[0].id),errUrlArr=angular.fromJson(errUrlJosn);-1==errUrlArr.indexOf(shortUrl)&&(errUrlArr.push(shortUrl),localStorage.setItem("errUrls"+tabs[0].id,angular.toJson(errUrlArr)))}else{var errUrlArr=[];errUrlArr.push(shortUrl),localStorage.setItem("errUrls"+tabs[0].id,angular.toJson(errUrlArr))}}}})},{urls:["<all_urls>"]}),null==cToken?(fwToolbar.setPac(!1),chrome.browserAction.setIcon({path:"images/icon-never.png"},function(){}),!1):(fwToolbar.cktokenServer(cToken),fwToolbar.setPac(!0),chrome.browserAction.setIcon({path:"images/fw.png"},function(){}),void 0)});