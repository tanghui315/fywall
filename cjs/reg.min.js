var fwReg=angular.module("fwReg",["facapp"]);fwReg.controller("regCtr",function($scope,$http,faConfig,fwToolbar){null!=localStorage.getItem("token")&&chrome.tabs.getCurrent(function(tab){chrome.tabs.update(tab.id,{url:chrome.extension.getURL("options.html")})});var member=$scope.member={};member.submitReg=function(reg_form){reg_form.$valid&&(member.dis=!0,$http.post(faConfig.ajaxUrl+"index.php?r=member/create",{user_name:member.email,mail_code:member.email_code,pwd:member.pwd}).success(function(data,status,headers,config){if(1==data.code){localStorage.setItem("token",data.access_token),localStorage.setItem("username",member.email),localStorage.setItem("urls",angular.toJson(data.web_url_arr)),localStorage.setItem("ps",data.s),localStorage.setItem("pss",data.ss),localStorage.setItem("days",data.expire_days),localStorage.setItem("version",data.version);var d=new Date;localStorage.setItem("logintime",d.getTime()),localStorage.setItem("hostname",data.host_name),localStorage.setItem("mode",1),fwToolbar.setPac(!0),chrome.tabs.getCurrent(function(tab){chrome.tabs.update(tab.id,{url:chrome.extension.getURL("options.html")})}),chrome.browserAction.setIcon({path:"images/fw.png"},function(){})}else alert(data.msg),member.dis=!1,chrome.browserAction.setIcon({path:"images/icon-never.png"},function(){})}).error(function(data,status,headers,config){}))},member.sendCode=function(reg_form){member.code_msg="邮件正在发送中...",reg_form.member_email.$valid?$http.post(faConfig.ajaxUrl+"index.php?r=member/ckmail",{user_name:reg_form.member_email.$viewValue}).success(function(data,status,headers,config){1==data.code?member.code_msg="发送成功，请查收邮件":member.code_msg=data.msg}).error(function(data,status,headers,config){}):member.code_msg="请输入邮箱地址"}});